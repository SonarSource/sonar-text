provider:
  metadata:
    name: SonarQube Scoped Organization Token
    category: Code Analysis
    message: Make sure this SonarQube Scoped Organization Token gets revoked, changed, and removed from the code.

  rules:
    - id: sonarqube-token-scoped
      rspecKey: S7791
      metadata:
        name: SonarQube Scoped Organization Tokens should not be disclosed
      detection:
        pre:
          include:
            content:
              - sqco_
        matching:
          pattern: >-
            \b(sqco_[0-9a-zA-Z]{59})\b
      examples:
        # Noncompliant example from the RSPEC
        - text: |
            props.set("sonar_token", "sqco_d4g8QujFirQJsaEgtgCnMgCAB5vhgfiFMltQUvGjoMqMn0SAbZn5Ijxr83O") // Noncompliant
          containsSecret: true
          match: sqco_d4g8QujFirQJsaEgtgCnMgCAB5vhgfiFMltQUvGjoMqMn0SAbZn5Ijxr83O
        # Compliant example from the RSPEC
        - text: |
            props.set("sonar_token", System.getenv("SONAR_TOKEN"))
          containsSecret: false
        - text: |
            SONARQUBE_SERVER_URL: process.env.SONARQUBE_SERVER_URL || 'https://sonarqube.example',
            SONARQUBE_TOKEN: process.env.SONARQUBE_TOKEN || 'sqco_d4g8QujFirQJsaEgtgCnMgCAB5vhgfiFMltQUvGjoMqMn0SAbZn5Ijxr83O',
          containsSecret: true
          match: sqco_d4g8QujFirQJsaEgtgCnMgCAB5vhgfiFMltQUvGjoMqMn0SAbZn5Ijxr83O
        - text: |
            SONARQUBE_TOKEN: process.env.SONARQUBE_TOKEN
          containsSecret: false
