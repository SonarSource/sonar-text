provider:
  metadata:
    name: GitLab
    category: Code hosting
    message: Make sure this GitLab token gets revoked, changed, and removed from the code.
  detection:
    post:
      heuristicFilter:
        heuristics: # Not sure this is implemented yet. Will make sense when it is.
          - path
          - uri

  rules:
    - id: gitlab-v2-tokens
      rspecKey: S6690
      metadata:
        name: Gitlab tokens should not be disclosed
      detection:
        pre:
          include:
            content:
              - glpat-

        matching:
          pattern: "\\b(glpat-[a-zA-Z0-9_-]{20})\\b"
        post:
          statisticalFilter:
            threshold: 3.9 # Based on significant sampling, 4.0 < entropy < 4.8
      examples:
        - text: |
            gl_token=glpat-zcs1FfaxGnHfvzd7ExHz
          containsSecret: true
          match: glpat-zcs1FfaxGnHfvzd7ExHz
        - text: |
            // noncompliant example
            props.set("token", "glpat-zcs1FfaxGnHfvzd7ExHz")
          containsSecret: true
          match: glpat-zcs1FfaxGnHfvzd7ExHz
        - text: |
            props.set("token", System.getenv("TOKEN"))
          containsSecret: false
    
