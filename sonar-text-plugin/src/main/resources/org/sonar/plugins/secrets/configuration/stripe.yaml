provider:
  metadata:
    name: Stripe Webhook Secret
    category: Financial Service
    message: Make sure this Stripe Webhook secret gets revoked, changed, and removed from the code.

  rules:
    - rspecKey: S6718
      id: stripe-webhook-secret
      metadata:
        name: Stripe Webhook URL
      examples:
        - text: |
            endpoint_secret = 'whsec_AV1cfC0WFpnYPzHI1YUnlDS059g8I3Az';
            post '/webhook' do
              payload = request.body.read
              event = nil
          containsSecret: true
          match: whsec_AV1cfC0WFpnYPzHI1YUnlDS059g8I3Az
        - text: |
            endpoint_secret = 'whsec_...';
            post '/webhook' do
              payload = request.body.read
              event = nil
          containsSecret: false
        - text: |
            endpoint_secret = 'whsec_0000000000000000000000000000000000000000000000000000000000000000';
            post '/webhook' do
              payload = request.body.read
              event = nil
          containsSecret: false
      detection:
        matching:
          pattern: "(whsec_[0-9a-zA-Z]{32,64})"
        post:
          # Avoid matching values found on SourceGraph that look like dummy passwords or insertions like:
          # - whsec_0000000000000000000000000000000000000000000000000000000000000000
          # - whsec_abcd1234abcd1234abcd1234abcd1234
          # - whsec_zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz
          # - whsec_yourwebhookpaymentmethodsigningkey
          patternNot: 
            "(?i)\
            (\\w)\\1{7,}|\
            yourwebhookpaymentmethodsigningkey|\
            abcd1234"
    
