provider:
  metadata:
    name: NPM
    category: Package repository
    message: Make sure this NPM API token gets revoked, changed, and removed from the code.
  detection:
    pre:
      include:
        content:
          - npm_

  rules:
    - id: npm-access-token
      rspecKey: S6758
      metadata:
        name: NPM access tokens should not be disclosed
      detection:
        matching:
          pattern: "(npm_[0-9A-Za-z]{36})\\b"
      examples:
        - text: |
            steps:
              - run: |
                  npm install
              - env:
                  NPM_TOKEN: npm_tCEMceczuiTXKQaBjGIaAezYQ63PqI972ANG
          containsSecret: true
          match: npm_tCEMceczuiTXKQaBjGIaAezYQ63PqI972ANG
        - text: |
            steps:
              - run: |
                  npm install
              - env:
                  NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
          containsSecret: false
        - text: |
            //registry.npmjs.org/:_authToken=npm_zLJhqeZs81Bhpxan9A0qH8d2wh15DoifLdLd
          containsSecret: true
          match: npm_zLJhqeZs81Bhpxan9A0qH8d2wh15DoifLdLd
        - text: |
            //registry.npmjs.org/:_authToken=${NPM_TOKEN}
          containsSecret: false
