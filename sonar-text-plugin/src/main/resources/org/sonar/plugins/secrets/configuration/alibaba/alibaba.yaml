provider:
  metadata:
    name: Alibaba 
    category: Cloud provider
    references:
    description: description.adoc
  modules:
    pre:
      include:
        - paths:
            - ".env"
            - ".*env*"
        - ext:
            - ".config"
        - content:
            - "alibaba"
      reject:
        - paths: "*/tests?/*"
    post:
        - pattern-not: "EXAMPLE"

rules:

  - id: alibaba-cloud-access-key-id
    metadata:
      name: AWS Secret Access Keys should not be disclosed
      message: Make sure this Alibaba Cloud Access Key ID gets revoked, changed, and removed from the code.
      impact: alibaba-secret-access.adoc
    examples:
      - text: >
          String fileContent = "LTAI5tBcc9SecYAo";
        match: LTAI5tBcc9SecYAo
      - text: >
          String fileContent = "LTAI5tBcc9SecYAomgyUSFs8";
        match: LTAI5tBcc9SecYAomgyUSFs8
      - text: >
          LNTTAI5tBcc9SecYAomgyUSFs8
          // extra characters before
          assertThat(analyze(check, "BEFLNTTAI5tBcc9SecYAomgyUSFs8")).isEmpty();
          // extra characters after
          assertThat(analyze(check, "LNTTAI5tBcc9SecYAomgyUSFs8AFT")).isEmpty();
        match: false
    modules:
      matching:
        pattern: "\\b(LTAI[0-9A-Za-z]{12}(:?[0-9A-Za-z]{8})?)\\b"

  - id: alibaba-cloud-access-key-secret
    metadata:
      name: AWS Access Key IDs should not be disclosed
      message: Make sure this Alibaba Cloud Access Key Secret gets revoked, changed, and removed from the code.
      impact: alibaba-secret-access.adoc
    examples:
      - text: >
          String fileContent = String aliyunAccessKeySecret="KmkwlDrPBC68bgvZiNtrjonKIYmVT8";
        match: KmkwlDrPBC68bgvZiNtrjonKIYmVT8
      - text: >
          static string AccessKeySecret = "l0GdwcDYdJwB1VJ5pv0ormyTV9nhvW";
        match: l0GdwcDYdJwB1VJ5pv0ormyTV9nhvW
      - text: >
          String aliyunAccessKeySecret = "KmkwlDrPBC68bgvZiNtrjonKIYmVT8";
        match: KmkwlDrPBC68bgvZiNtrjonKIYmVT8 
      - text: >
          String aliyunAccessKeySecret = "100000000000000000000000000000";
        match: false
    modules:
      matching:
        match-either:
          - match-each:
            - pattern-around: "(?i)(?:SECRET_?(?:ACCESS)?_?KEY|(?:ACCESS)?_?KEY_?SECRET)\\b"
            - pattern: "(?i)([0-9a-z]{30})(?![a-z0-9\/+=$\-_])"
          - match-each:
            - pattern-around: "(?i)(?<![A-Z])ali(?:yun|baba|cloud)"
            - pattern: "(?i)([0-9a-z]{30})(?![a-z0-9\/+=$\-_])"
      post:
        - statistical-filter: 4.2
        - pattern-not: EXAMPLE
